<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediSuite Agent</title>
    <meta name="description"
        content="MediSuite Agent: AI-powered multi-agent system for automated medical claim generation and processing.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-primary: #06090f;
            --bg-secondary: #0d1117;
            --bg-card: rgba(13, 17, 23, 0.85);
            --bg-sidebar: #0a0e16;
            --bg-hover: rgba(255, 255, 255, 0.04);
            --bg-glass: rgba(255, 255, 255, 0.025);
            --border: rgba(255, 255, 255, 0.06);
            --border-active: rgba(99, 102, 241, 0.45);
            --text: #e2e8f0;
            --text-dim: #8b95a5;
            --text-muted: #4a5568;
            --accent: #6366f1;
            --accent-soft: rgba(99, 102, 241, 0.12);
            --green: #10b981;
            --green-soft: rgba(16, 185, 129, 0.12);
            --red: #ef4444;
            --red-soft: rgba(239, 68, 68, 0.1);
            --yellow: #f59e0b;
            --yellow-soft: rgba(245, 158, 11, 0.1);
            --blue: #3b82f6;
            --blue-soft: rgba(59, 130, 246, 0.1);
            --cyan: #06b6d4;
            --cyan-soft: rgba(6, 182, 212, 0.1);
            --r: 14px;
            --r-sm: 10px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .sidebar {
            width: 260px;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            z-index: 10;
        }

        .sidebar__logo {
            padding: 24px 20px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar__logo-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--r-sm);
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .sidebar__logo-text {
            font-size: 1.05rem;
            font-weight: 700;
            background: linear-gradient(135deg, #f1f5f9, #6366f1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .sidebar__nav {
            flex: 1;
            padding: 12px 10px;
            overflow-y: auto;
        }

        .nav-section {
            font-size: .65rem;
            text-transform: uppercase;
            letter-spacing: .1em;
            color: var(--text-muted);
            padding: 16px 12px 6px;
            font-weight: 600;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: var(--r-sm);
            color: var(--text-dim);
            font-size: .88rem;
            font-weight: 500;
            cursor: pointer;
            transition: all .2s;
            text-decoration: none;
            margin-bottom: 2px;
        }

        .nav-item:hover {
            background: var(--bg-hover);
            color: var(--text);
        }

        .nav-item.active {
            background: var(--accent-soft);
            color: var(--accent);
            font-weight: 600;
        }

        .nav-item .ico {
            width: 20px;
            text-align: center;
            font-size: 1rem;
        }

        .nav-item .badge {
            margin-left: auto;
            background: var(--accent-soft);
            color: var(--accent);
            font-size: .65rem;
            padding: 2px 7px;
            border-radius: 99px;
            font-weight: 600;
        }

        .sidebar__footer {
            padding: 14px 16px;
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sidebar__health-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .sidebar__health-dot.ok {
            background: var(--green);
        }

        .sidebar__health-dot.warn {
            background: var(--yellow);
        }

        .sidebar__health-text {
            font-size: .72rem;
            color: var(--text-muted);
        }

        /* â”€â”€ Main Content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .topbar {
            height: 56px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 28px;
            gap: 16px;
            flex-shrink: 0;
            background: var(--bg-secondary);
        }

        .topbar__title {
            font-size: 1.05rem;
            font-weight: 700;
        }

        .topbar__breadcrumb {
            font-size: .8rem;
            color: var(--text-muted);
        }

        .topbar__spacer {
            flex: 1;
        }

        .topbar__btn {
            padding: 7px 16px;
            border-radius: var(--r-sm);
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-dim);
            font-family: inherit;
            font-size: .8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all .2s;
        }

        .topbar__btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .topbar__btn.primary {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            border-color: transparent;
            color: #fff;
        }

        .topbar__btn.primary:hover {
            opacity: .9;
        }

        .content {
            flex: 1;
            overflow-y: auto;
            padding: 28px;
        }

        /* â”€â”€ Page container â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .page {
            display: none;
            animation: fadeIn .3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(6px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* â”€â”€ Stat cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--r);
            padding: 22px;
            transition: border-color .3s;
        }

        .stat:hover {
            border-color: rgba(255, 255, 255, .1);
        }

        .stat__label {
            font-size: .7rem;
            text-transform: uppercase;
            letter-spacing: .06em;
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .stat__value {
            font-size: 1.6rem;
            font-weight: 800;
        }

        .stat__sub {
            font-size: .75rem;
            color: var(--text-dim);
            margin-top: 4px;
        }

        .stat--green .stat__value {
            color: var(--green);
        }

        .stat--red .stat__value {
            color: var(--red);
        }

        .stat--yellow .stat__value {
            color: var(--yellow);
        }

        .stat--accent .stat__value {
            color: var(--accent);
        }

        /* â”€â”€ Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--r);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .card__header {
            padding: 18px 22px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: .95rem;
        }

        .card__header .ico {
            font-size: 1.1rem;
        }

        .card__body {
            padding: 22px;
        }

        .card__body--flush {
            padding: 0;
        }

        /* â”€â”€ Tables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .tbl {
            width: 100%;
            border-collapse: collapse;
            font-size: .84rem;
        }

        .tbl th {
            text-align: left;
            padding: 10px 16px;
            font-size: .7rem;
            text-transform: uppercase;
            letter-spacing: .06em;
            color: var(--text-muted);
            font-weight: 600;
            border-bottom: 1px solid var(--border);
            background: var(--bg-glass);
        }

        .tbl td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            color: var(--text-dim);
            vertical-align: top;
        }

        .tbl tbody tr {
            transition: background .15s;
        }

        .tbl tbody tr:hover {
            background: var(--bg-hover);
        }

        .tbl tbody tr:last-child td {
            border-bottom: none;
        }

        .tbl .clickable {
            cursor: pointer;
        }

        /* â”€â”€ Badges â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .badge-pill {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 10px;
            border-radius: 99px;
            font-size: .72rem;
            font-weight: 600;
        }

        .badge-pill.approve {
            background: var(--green-soft);
            color: var(--green);
        }

        .badge-pill.deny {
            background: var(--red-soft);
            color: var(--red);
        }

        .badge-pill.review {
            background: var(--yellow-soft);
            color: var(--yellow);
        }

        .badge-pill.valid {
            background: var(--green-soft);
            color: var(--green);
        }

        .badge-pill.invalid {
            background: var(--red-soft);
            color: var(--red);
        }

        .badge-pill.info {
            background: var(--blue-soft);
            color: var(--blue);
        }

        .badge-pill.neutral {
            background: var(--bg-glass);
            color: var(--text-dim);
        }

        .badge-pill.cyan {
            background: var(--cyan-soft);
            color: var(--cyan);
        }

        /* â”€â”€ Tabs (claims sub-pages) â”€â”€â”€â”€â”€â”€ */
        .tabs {
            display: flex;
            gap: 2px;
            padding: 0 22px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-glass);
        }

        .tab {
            padding: 10px 18px;
            font-size: .82rem;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all .2s;
        }

        .tab:hover {
            color: var(--text-dim);
        }

        .tab.active {
            color: var(--accent);
            border-color: var(--accent);
            font-weight: 600;
        }

        .tab-content {
            display: none;
            padding: 22px;
        }

        .tab-content.active {
            display: block;
        }

        /* â”€â”€ Upload form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .upload-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            margin-bottom: 20px;
        }

        .upload-zone {
            background: var(--bg-glass);
            border: 2px dashed rgba(255, 255, 255, .07);
            border-radius: var(--r-sm);
            padding: 22px 18px;
            text-align: center;
            cursor: pointer;
            transition: all .25s;
            position: relative;
            overflow: hidden;
        }

        .upload-zone:hover {
            border-color: var(--accent);
            background: var(--accent-soft);
        }

        .upload-zone.has-file {
            border-color: var(--green);
            background: var(--green-soft);
        }

        .upload-zone input[type=file] {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
        }

        .upload-zone__icon {
            font-size: 1.8rem;
            margin-bottom: 6px;
        }

        .upload-zone__label {
            font-weight: 600;
            font-size: .85rem;
            margin-bottom: 2px;
        }

        .upload-zone__hint {
            color: var(--text-muted);
            font-size: .72rem;
        }

        .upload-zone__fname {
            color: var(--green);
            font-size: .76rem;
            font-weight: 500;
            margin-top: 4px;
            display: none;
        }

        .upload-zone.has-file .upload-zone__fname {
            display: block;
        }

        /* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 11px 24px;
            border: none;
            border-radius: var(--r-sm);
            font-family: inherit;
            font-size: .88rem;
            font-weight: 600;
            cursor: pointer;
            transition: all .2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: #fff;
            box-shadow: 0 4px 16px rgba(99, 102, 241, .25);
            width: 100%;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, .35);
        }

        .btn-primary:disabled {
            opacity: .45;
            cursor: not-allowed;
        }

        .btn-sm {
            padding: 7px 14px;
            font-size: .78rem;
            border-radius: 8px;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-dim);
        }

        .btn-outline:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .btn-green {
            background: var(--green-soft);
            border: 1px solid rgba(16, 185, 129, .25);
            color: var(--green);
        }

        .btn-green:hover {
            background: rgba(16, 185, 129, .2);
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, .2);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin .6s linear infinite;
            display: none;
        }

        .loading .spinner {
            display: inline-block;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* â”€â”€ Pipeline â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .pipeline {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 16px;
        }

        .pipe-step {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 14px;
            border-radius: var(--r-sm);
            background: var(--bg-glass);
            border: 1px solid var(--border);
            transition: all .35s;
        }

        .pipe-step.active {
            border-color: rgba(99, 102, 241, .3);
            background: var(--accent-soft);
        }

        .pipe-step.done {
            border-color: rgba(16, 185, 129, .3);
            background: var(--green-soft);
        }

        .pipe-step.error {
            border-color: rgba(239, 68, 68, .3);
            background: var(--red-soft);
        }

        .pipe-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-muted);
            flex-shrink: 0;
            transition: background .3s;
        }

        .pipe-step.active .pipe-dot {
            background: var(--accent);
            animation: pulse 1.2s infinite;
        }

        .pipe-step.done .pipe-dot {
            background: var(--green);
        }

        .pipe-step.error .pipe-dot {
            background: var(--red);
        }

        .pipe-name {
            font-weight: 500;
            font-size: .84rem;
            flex: 1;
        }

        .pipe-time {
            font-size: .72rem;
            color: var(--text-muted);
        }

        @keyframes pulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(99, 102, 241, .4);
            }

            50% {
                box-shadow: 0 0 0 5px rgba(99, 102, 241, 0);
            }
        }

        /* â”€â”€ Status panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .status-panel {
            display: none;
            margin-top: 18px;
        }

        .status-panel.visible {
            display: block;
        }

        /* â”€â”€ Results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .results-panel {
            display: none;
        }

        .results-panel.visible {
            display: block;
        }

        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        /* â”€â”€ Settings form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .setting-row {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 14px 0;
            border-bottom: 1px solid var(--border);
        }

        .setting-row:last-child {
            border-bottom: none;
        }

        .setting-label {
            width: 200px;
            font-size: .82rem;
            font-weight: 600;
            color: var(--text-dim);
            flex-shrink: 0;
        }

        .setting-value {
            font-size: .82rem;
            font-family: 'Courier New', monospace;
            color: var(--text);
            word-break: break-all;
            flex: 1;
        }

        .setting-badge {
            margin-left: auto;
            flex-shrink: 0;
        }

        /* â”€â”€ Knowledge cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .kb-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 14px;
        }

        .kb-card {
            background: var(--bg-glass);
            border: 1px solid var(--border);
            border-radius: var(--r-sm);
            padding: 18px;
            transition: border-color .2s;
        }

        .kb-card:hover {
            border-color: rgba(255, 255, 255, .1);
        }

        .kb-card__type {
            font-size: .65rem;
            text-transform: uppercase;
            letter-spacing: .08em;
            color: var(--accent);
            font-weight: 700;
            margin-bottom: 8px;
        }

        .kb-card__content {
            font-size: .8rem;
            color: var(--text-dim);
            line-height: 1.5;
        }

        .kb-card__footer {
            margin-top: 10px;
            font-size: .7rem;
            color: var(--text-muted);
            display: flex;
            justify-content: space-between;
        }

        .kb-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 18px;
            flex-wrap: wrap;
        }

        .filter-chip {
            padding: 5px 14px;
            border-radius: 99px;
            font-size: .75rem;
            font-weight: 500;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-dim);
            cursor: pointer;
            transition: all .2s;
            font-family: inherit;
        }

        .filter-chip:hover,
        .filter-chip.active {
            background: var(--accent-soft);
            border-color: var(--accent);
            color: var(--accent);
        }

        /* â”€â”€ Empty state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .empty {
            text-align: center;
            padding: 48px 20px;
            color: var(--text-muted);
        }

        .empty__icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            opacity: .5;
        }

        .empty__text {
            font-size: .9rem;
        }

        .empty__sub {
            font-size: .78rem;
            margin-top: 6px;
            color: var(--text-muted);
        }

        /* â”€â”€ JSON viewer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        pre.json {
            background: rgba(0, 0, 0, .35);
            border: 1px solid var(--border);
            border-radius: var(--r-sm);
            padding: 16px;
            font-size: .75rem;
            line-height: 1.55;
            overflow: auto;
            max-height: 350px;
            color: var(--text-dim);
        }

        /* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 12px 20px;
            border-radius: var(--r-sm);
            font-size: .82rem;
            font-weight: 500;
            z-index: 999;
            transform: translateY(90px);
            opacity: 0;
            transition: all .3s;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: var(--green-soft);
            color: var(--green);
            border: 1px solid rgba(16, 185, 129, .3);
        }

        .toast.error {
            background: var(--red-soft);
            color: var(--red);
            border: 1px solid rgba(239, 68, 68, .3);
        }

        /* â”€â”€ Detail back button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: .82rem;
            color: var(--text-muted);
            cursor: pointer;
            margin-bottom: 18px;
            transition: color .2s;
        }

        .back-link:hover {
            color: var(--accent);
        }

        /* â”€â”€ Chat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 56px - 56px);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 22px;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .chat-msg {
            display: flex;
            gap: 10px;
            max-width: 85%;
            animation: fadeIn .25s ease;
        }

        .chat-msg.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .chat-msg.bot {
            align-self: flex-start;
        }

        .chat-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: .9rem;
            flex-shrink: 0;
        }

        .chat-msg.user .chat-avatar {
            background: var(--accent-soft);
        }

        .chat-msg.bot .chat-avatar {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
        }

        .chat-bubble {
            padding: 12px 16px;
            border-radius: var(--r);
            font-size: .85rem;
            line-height: 1.6;
        }

        .chat-msg.user .chat-bubble {
            background: var(--accent-soft);
            color: var(--text);
            border-bottom-right-radius: 4px;
        }

        .chat-msg.bot .chat-bubble {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-dim);
            border-bottom-left-radius: 4px;
        }

        .chat-bubble strong {
            color: var(--text);
        }

        .chat-bubble code {
            background: rgba(0, 0, 0, .3);
            padding: 1px 5px;
            border-radius: 4px;
            font-size: .8rem;
        }

        .chat-agent-tag {
            font-size: .65rem;
            color: var(--accent);
            font-weight: 600;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: .05em;
        }

        .chat-input-area {
            padding: 16px 22px;
            border-top: 1px solid var(--border);
            background: var(--bg-secondary);
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            background: var(--bg-glass);
            border: 1px solid var(--border);
            border-radius: var(--r-sm);
            padding: 12px 16px;
            color: var(--text);
            font-family: inherit;
            font-size: .88rem;
            outline: none;
            transition: border-color .2s;
            resize: none;
        }

        .chat-input:focus {
            border-color: var(--accent);
        }

        .chat-input::placeholder {
            color: var(--text-muted);
        }

        .chat-send {
            padding: 0 20px;
            border: none;
            border-radius: var(--r-sm);
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: #fff;
            font-family: inherit;
            font-size: .88rem;
            font-weight: 600;
            cursor: pointer;
            transition: all .2s;
        }

        .chat-send:hover:not(:disabled) {
            opacity: .9;
            transform: translateY(-1px);
        }

        .chat-send:disabled {
            opacity: .4;
            cursor: not-allowed;
        }

        .chat-welcome {
            text-align: center;
            padding: 40px 20px;
        }

        .chat-welcome__icon {
            font-size: 3rem;
            margin-bottom: 12px;
        }

        .chat-welcome__title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .chat-welcome__sub {
            font-size: .82rem;
            color: var(--text-muted);
            max-width: 400px;
            margin: 0 auto 20px;
        }

        .chat-suggestions {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            max-width: 500px;
            margin: 0 auto;
        }

        .chat-suggestion {
            padding: 6px 14px;
            border-radius: 99px;
            font-size: .76rem;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-dim);
            cursor: pointer;
            font-family: inherit;
            transition: all .2s;
        }

        .chat-suggestion:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: var(--accent-soft);
        }

        .chat-typing {
            display: flex;
            gap: 4px;
            padding: 8px 0;
        }

        .chat-typing span {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--text-muted);
            animation: typingDot 1.2s infinite;
        }

        .chat-typing span:nth-child(2) {
            animation-delay: .2s;
        }

        .chat-typing span:nth-child(3) {
            animation-delay: .4s;
        }

        @keyframes typingDot {

            0%,
            80%,
            100% {
                opacity: .3;
                transform: scale(1);
            }

            40% {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        @media(max-width:768px) {
            .sidebar {
                display: none;
            }

            .upload-grid,
            .result-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <aside class="sidebar">
        <div class="sidebar__logo">
            <div class="sidebar__logo-icon">ğŸ¥</div>
            <div class="sidebar__logo-text">MediSuite</div>
        </div>
        <nav class="sidebar__nav">
            <div class="nav-section">Main</div>
            <a class="nav-item active" data-page="dashboard"><span class="ico">ğŸ“Š</span> Dashboard</a>
            <a class="nav-item" data-page="claims"><span class="ico">ğŸ“‘</span> Claims <span class="badge"
                    id="navClaimsBadge">0</span></a>
            <a class="nav-item" data-page="new-claim"><span class="ico">â•</span> New Claim</a>
            <div class="nav-section">Intelligence</div>
            <a class="nav-item" data-page="knowledge"><span class="ico">ğŸ§ </span> Knowledge Base <span class="badge"
                    id="navKbBadge">0</span></a>
            <a class="nav-item" data-page="chat"><span class="ico">ğŸ’¬</span> Chat with Agent</a>
            <div class="nav-section">System</div>
            <a class="nav-item" data-page="settings"><span class="ico">âš™ï¸</span> Settings</a>
        </nav>
        <div class="sidebar__footer">
            <div class="sidebar__health-dot" id="sidebarHealth"></div>
            <div class="sidebar__health-text" id="sidebarHealthText">Checkingâ€¦</div>
        </div>
    </aside>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="main">
        <div class="topbar">
            <div class="topbar__title" id="topTitle">Dashboard</div>
            <div class="topbar__breadcrumb" id="topBreadcrumb"></div>
            <div class="topbar__spacer"></div>
            <button class="topbar__btn primary" onclick="navigateTo('new-claim')">â• New Claim</button>
        </div>
        <div class="content" id="content">

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DASHBOARD PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div class="page active" id="page-dashboard">
                <div class="stats-grid" id="dashStats"></div>
                <div class="card">
                    <div class="card__header"><span class="ico">ğŸ“‘</span> Recent Claims</div>
                    <div class="card__body--flush">
                        <table class="tbl">
                            <thead>
                                <tr>
                                    <th>Claim ID</th>
                                    <th>Patient</th>
                                    <th>Decision</th>
                                    <th>Amount</th>
                                    <th>Duration</th>
                                </tr>
                            </thead>
                            <tbody id="dashRecentClaims">
                                <tr>
                                    <td colspan="5" class="empty">
                                        <div class="empty__text">No claims yet</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CLAIMS LIST PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div class="page" id="page-claims">
                <div id="claimsList"></div>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CLAIM DETAIL PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div class="page" id="page-claim-detail">
                <div class="back-link" onclick="navigateTo('claims')">â† Back to Claims</div>
                <div style="display:flex;align-items:center;gap:14px;margin-bottom:20px;">
                    <h2 id="claimDetailTitle" style="font-size:1.3rem;font-weight:700;"></h2>
                    <span class="badge-pill" id="claimDetailDecision"></span>
                </div>
                <div class="stats-grid" id="claimDetailStats"></div>
                <div class="card">
                    <div class="tabs" id="claimTabs">
                        <div class="tab active" data-tab="runs">ğŸ”„ Agent Runs</div>
                        <div class="tab" data-tab="artifacts">ğŸ“ Artifacts</div>
                        <div class="tab" data-tab="audit">ğŸ“‹ Audit Log</div>
                    </div>
                    <div class="tab-content active" data-tab="runs" id="tabRuns"></div>
                    <div class="tab-content" data-tab="artifacts" id="tabArtifacts"></div>
                    <div class="tab-content" data-tab="audit" id="tabAudit"></div>
                </div>
                <div class="card">
                    <div class="card__header"><span class="ico">ğŸ“‹</span> Full JSON</div>
                    <div class="card__body">
                        <pre class="json" id="claimDetailJson"></pre>
                    </div>
                </div>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• NEW CLAIM PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div class="page" id="page-new-claim">
                <div class="card">
                    <div class="card__header"><span class="ico">ğŸ“</span> Upload Claim Documents</div>
                    <div class="card__body">
                        <form id="workflowForm">
                            <div class="upload-grid">
                                <div class="upload-zone" id="uz-patient">
                                    <input type="file" id="fPatient" accept=".json" required>
                                    <div class="upload-zone__icon">ğŸ§‘â€âš•ï¸</div>
                                    <div class="upload-zone__label">Patient Information</div>
                                    <div class="upload-zone__hint">JSON file</div>
                                    <div class="upload-zone__fname" id="fnPatient"></div>
                                </div>
                                <div class="upload-zone" id="uz-notes">
                                    <input type="file" id="fNotes" accept=".txt,.text" required>
                                    <div class="upload-zone__icon">ğŸ“‹</div>
                                    <div class="upload-zone__label">Clinical Notes</div>
                                    <div class="upload-zone__hint">Text file</div>
                                    <div class="upload-zone__fname" id="fnNotes"></div>
                                </div>
                                <div class="upload-zone" id="uz-meta">
                                    <input type="file" id="fMeta" accept=".json">
                                    <div class="upload-zone__icon">ğŸ·ï¸</div>
                                    <div class="upload-zone__label">Document Metadata</div>
                                    <div class="upload-zone__hint">Optional JSON</div>
                                    <div class="upload-zone__fname" id="fnMeta"></div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary" id="submitBtn"><span
                                    class="spinner"></span><span id="submitText">âš¡ Process Claim</span></button>
                        </form>
                        <div class="status-panel" id="statusPanel">
                            <div class="pipeline" id="pipeline">
                                <div class="pipe-step" data-step="patient_data">
                                    <div class="pipe-dot"></div>
                                    <div class="pipe-name">Patient Data Agent</div>
                                    <div class="pipe-time"></div>
                                </div>
                                <div class="pipe-step" data-step="document_code">
                                    <div class="pipe-dot"></div>
                                    <div class="pipe-name">Document Code Agent</div>
                                    <div class="pipe-time"></div>
                                </div>
                                <div class="pipe-step" data-step="coverage_validation">
                                    <div class="pipe-dot"></div>
                                    <div class="pipe-name">Coverage Validation Agent</div>
                                    <div class="pipe-time"></div>
                                </div>
                                <div class="pipe-step" data-step="claim_generation">
                                    <div class="pipe-dot"></div>
                                    <div class="pipe-name">Claim Generation Agent</div>
                                    <div class="pipe-time"></div>
                                </div>
                                <div class="pipe-step" data-step="triage">
                                    <div class="pipe-dot"></div>
                                    <div class="pipe-name">Triage Agent</div>
                                    <div class="pipe-time"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="results-panel" id="resultsPanel">
                    <div class="card">
                        <div class="card__header"><span class="ico">âœ…</span> Workflow Result</div>
                        <div class="card__body">
                            <div class="result-grid" id="resultGrid">
                                <div class="stat">
                                    <div class="stat__label">Claim ID</div>
                                    <div class="stat__value" id="rClaimId">â€”</div>
                                </div>
                                <div class="stat">
                                    <div class="stat__label">Decision</div>
                                    <div class="stat__value" id="rDecision">â€”</div>
                                </div>
                                <div class="stat">
                                    <div class="stat__label">Amount</div>
                                    <div class="stat__value" id="rAmount">â€”</div>
                                </div>
                                <div class="stat">
                                    <div class="stat__label">Duration</div>
                                    <div class="stat__value" id="rDuration">â€”</div>
                                </div>
                            </div>
                            <div style="display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap;">
                                <button class="btn btn-sm btn-green" id="rPdf" style="display:none">ğŸ“„ Download
                                    PDF</button>
                                <button class="btn btn-sm btn-outline" id="rViewDetail" style="display:none">ğŸ” View
                                    Details</button>
                            </div>
                            <pre class="json" id="rJustification" style="max-height:80px;"></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• KNOWLEDGE BASE PAGE â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div class="page" id="page-knowledge">
                <div class="kb-filters" id="kbFilters">
                    <button class="filter-chip active" data-filter="">All</button>
                    <button class="filter-chip" data-filter="patient_data">Patient Data</button>
                    <button class="filter-chip" data-filter="icd10_code">ICD-10</button>
                    <button class="filter-chip" data-filter="cpt4_code">CPT-4</button>
                    <button class="filter-chip" data-filter="validation_result">Validation</button>
                    <button class="filter-chip" data-filter="triage_decision">Triage</button>
                </div>
                <div class="kb-grid" id="kbGrid">
                    <div class="empty">
                        <div class="empty__icon">ğŸ§ </div>
                        <div class="empty__text">No knowledge entries yet</div>
                        <div class="empty__sub">Process a claim to populate the knowledge base</div>
                    </div>
                </div>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SETTINGS PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div class="page" id="page-settings">
                <div class="card">
                    <div class="card__header"><span class="ico">ğŸ”—</span> Azure Service Connections</div>
                    <div class="card__body" id="settingsBody">
                        <div class="empty">
                            <div class="empty__icon">âš™ï¸</div>
                            <div class="empty__text">Loading settingsâ€¦</div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card__header"><span class="ico">â„¹ï¸</span> About MediSuite Agent</div>
                    <div class="card__body">
                        <div class="setting-row">
                            <div class="setting-label">Version</div>
                            <div class="setting-value">1.0.0</div>
                        </div>
                        <div class="setting-row">
                            <div class="setting-label">Python SDK</div>
                            <div class="setting-value">azure-ai-projects</div>
                        </div>
                        <div class="setting-row">
                            <div class="setting-label">Agents</div>
                            <div class="setting-value">Patient Data, Document Code, Coverage Validation, Claim
                                Generation, Triage</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CHAT PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div class="page" id="page-chat">
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-welcome">
                            <div class="chat-welcome__icon">ğŸ¤–</div>
                            <div class="chat-welcome__title">Chat with MediSuite Agent</div>
                            <div class="chat-welcome__sub">Ask me about claims, medical codes, insurance policies, or
                                how the pipeline works.</div>
                            <div class="chat-suggestions">
                                <button class="chat-suggestion"
                                    onclick="sendSuggestion('Show me a summary of all claims')">ğŸ“Š Claims
                                    Summary</button>
                                <button class="chat-suggestion"
                                    onclick="sendSuggestion('What is ICD-10 code J10.1?')">ğŸ” Lookup ICD-10</button>
                                <button class="chat-suggestion" onclick="sendSuggestion('Check policy ABC123456')">ğŸ›¡ï¸
                                    Check Policy</button>
                                <button class="chat-suggestion" onclick="sendSuggestion('Show denied claims')">âŒ Denied
                                    Claims</button>
                                <button class="chat-suggestion"
                                    onclick="sendSuggestion('How does the pipeline work?')">âš™ï¸ Pipeline Info</button>
                                <button class="chat-suggestion" onclick="sendSuggestion('What is CPT code 27447?')">ğŸ’Š
                                    Lookup CPT-4</button>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <input type="text" class="chat-input" id="chatInput"
                            placeholder="Ask about claims, codes, policies, or agentsâ€¦" autocomplete="off">
                        <button class="chat-send" id="chatSend" onclick="sendChatMessage()">Send â¤</button>
                    </div>
                </div>
            </div>

        </div><!-- /content -->
    </div><!-- /main -->

    <div class="toast" id="toast"></div>

    <script>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ROUTING
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        const pageTitles = {
            'dashboard': 'Dashboard',
            'claims': 'Claims',
            'claim-detail': 'Claim Details',
            'new-claim': 'New Claim',
            'knowledge': 'Knowledge Base',
            'chat': 'Chat with Agent',
            'settings': 'Settings',
        };
        let currentPage = 'dashboard';
        let currentClaimId = null;

        function navigateTo(page, extra) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            const el = document.getElementById('page-' + page);
            if (el) el.classList.add('active');
            const nav = document.querySelector(`.nav-item[data-page="${page}"]`);
            if (nav) nav.classList.add('active');
            document.getElementById('topTitle').textContent = pageTitles[page] || page;
            document.getElementById('topBreadcrumb').textContent = '';
            currentPage = page;

            if (page === 'dashboard') loadDashboard();
            if (page === 'claims') loadClaims();
            if (page === 'claim-detail' && extra) { currentClaimId = extra; loadClaimDetail(extra); }
            if (page === 'knowledge') loadKnowledge();
            if (page === 'settings') loadSettings();
            if (page === 'chat') $('chatInput').focus();
        }

        document.querySelectorAll('.nav-item[data-page]').forEach(n => {
            n.addEventListener('click', () => navigateTo(n.dataset.page));
        });

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           HELPERS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        function toast(msg, type = 'success') {
            const t = document.getElementById('toast');
            t.textContent = msg; t.className = `toast ${type} show`;
            setTimeout(() => t.classList.remove('show'), 3200);
        }
        function $(id) { return document.getElementById(id); }
        function decisionClass(d) { return (d || '').toLowerCase(); }
        function money(v) { return '$' + Number(v || 0).toLocaleString('en-US', { minimumFractionDigits: 2 }); }
        function shortTime(iso) { if (!iso) return ''; try { return new Date(iso).toLocaleString(); } catch { return iso; } }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           DASHBOARD
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        async function loadDashboard() {
            try {
                const data = await (await fetch('/api/dashboard')).json();
                const d = data.decisions || {};
                $('dashStats').innerHTML = `
            <div class="stat stat--accent"><div class="stat__label">Total Claims</div><div class="stat__value">${data.total_claims}</div></div>
            <div class="stat stat--green"><div class="stat__label">Approved</div><div class="stat__value">${d.Approve || 0}</div></div>
            <div class="stat stat--red"><div class="stat__label">Denied</div><div class="stat__value">${d.Deny || 0}</div></div>
            <div class="stat stat--yellow"><div class="stat__label">In Review</div><div class="stat__value">${d.Review || 0}</div></div>
            <div class="stat"><div class="stat__label">Total Billed</div><div class="stat__value">${money(data.total_amount)}</div></div>
            <div class="stat"><div class="stat__label">Knowledge Entries</div><div class="stat__value">${data.knowledge_entries}</div></div>
        `;
                $('navClaimsBadge').textContent = data.total_claims;
                $('navKbBadge').textContent = data.knowledge_entries;

                // Recent claims
                const cl = await (await fetch('/api/claims')).json();
                const rows = (cl.claims || []).slice(0, 5).map(c => `
            <tr class="clickable" onclick="navigateTo('claim-detail','${c.claim_id}')">
                <td style="color:var(--accent);font-weight:600;">${c.claim_id}</td>
                <td>${c.patient}</td>
                <td><span class="badge-pill ${decisionClass(c.decision)}">${c.decision}</span></td>
                <td>${money(c.amount)}</td>
                <td>${c.duration_s}s</td>
            </tr>
        `).join('');
                $('dashRecentClaims').innerHTML = rows || '<tr><td colspan="5" class="empty"><div class="empty__icon">ğŸ“‘</div><div class="empty__text">No claims yet</div><div class="empty__sub">Process a new claim to get started</div></td></tr>';

                // Sidebar health
                const anyAzure = data.azure_ai || data.blob_storage || data.search;
                $('sidebarHealth').className = 'sidebar__health-dot ' + (anyAzure ? 'ok' : 'warn');
                $('sidebarHealthText').textContent = anyAzure ? 'Azure Connected' : 'Local Mode';
            } catch (e) { console.error(e); }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CLAIMS LIST
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        async function loadClaims() {
            try {
                const data = await (await fetch('/api/claims')).json();
                if (!data.claims.length) {
                    $('claimsList').innerHTML = '<div class="empty"><div class="empty__icon">ğŸ“‘</div><div class="empty__text">No claims processed yet</div><div class="empty__sub">Go to New Claim to process your first claim</div></div>';
                    return;
                }
                const rows = data.claims.map(c => `
            <tr class="clickable" onclick="navigateTo('claim-detail','${c.claim_id}')">
                <td style="color:var(--accent);font-weight:600">${c.claim_id}</td>
                <td>${c.patient}</td>
                <td><span class="badge-pill ${decisionClass(c.decision)}">${c.decision}</span></td>
                <td><span class="badge-pill ${c.validation_status === 'Valid' ? 'valid' : 'invalid'}">${c.validation_status || 'â€”'}</span></td>
                <td>${money(c.amount)}</td>
                <td><span class="badge-pill neutral">${(c.icd10_codes || []).join(', ') || 'â€”'}</span></td>
                <td>${c.duration_s}s</td>
                <td>${shortTime(c.created_at)}</td>
            </tr>
        `).join('');
                $('claimsList').innerHTML = `<div class="card"><div class="card__header"><span class="ico">ğŸ“‘</span> All Claims (${data.total})</div><div class="card__body--flush"><table class="tbl"><thead><tr><th>Claim ID</th><th>Patient</th><th>Decision</th><th>Validation</th><th>Amount</th><th>ICD-10</th><th>Duration</th><th>Created</th></tr></thead><tbody>${rows}</tbody></table></div></div>`;
            } catch (e) { console.error(e); }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CLAIM DETAIL + SUB-PAGES (Runs / Artifacts / Audit)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        async function loadClaimDetail(id) {
            $('topBreadcrumb').textContent = id;
            try {
                const claim = await (await fetch(`/api/claims/${id}`)).json();
                const s = claim.summary || {};
                $('claimDetailTitle').textContent = id;
                const dec = claim.steps?.triage?.decision || 'N/A';
                const dEl = $('claimDetailDecision');
                dEl.textContent = dec; dEl.className = 'badge-pill ' + decisionClass(dec);

                $('claimDetailStats').innerHTML = `
            <div class="stat"><div class="stat__label">Patient</div><div class="stat__value">${s.patient || 'â€”'}</div></div>
            <div class="stat"><div class="stat__label">Amount</div><div class="stat__value">${money(s.amount)}</div></div>
            <div class="stat"><div class="stat__label">Duration</div><div class="stat__value">${claim.total_duration_s || 0}s</div></div>
            <div class="stat"><div class="stat__label">Status</div><div class="stat__value">${claim.status || 'â€”'}</div></div>
        `;
                $('claimDetailJson').textContent = JSON.stringify(claim, null, 2);

                // Runs tab
                const runs = await (await fetch(`/api/claims/${id}/runs`)).json();
                $('tabRuns').innerHTML = (runs.runs || []).map(r => {
                    const statusClass = r.has_error ? 'error' : 'done';
                    const keys = (r.output_keys || []).filter(k => k !== 'duration_s' && k !== 'error').slice(0, 6);
                    let outputHtml = '';
                    if (r.has_error) { outputHtml = `<div style="color:var(--red);font-size:.78rem;">Error: ${r.error}</div>`; }
                    else {
                        const entries = Object.entries(r.output || {}).filter(([k]) => k !== 'duration_s').slice(0, 5);
                        outputHtml = entries.map(([k, v]) => `<div style="margin-bottom:4px;"><span style="color:var(--text-muted);font-size:.72rem;">${k}:</span> <span style="font-size:.78rem;color:var(--text-dim);">${typeof v === 'object' ? JSON.stringify(v) : v}</span></div>`).join('');
                    }
                    return `<div class="pipe-step ${statusClass}" style="flex-direction:column;align-items:flex-start;gap:8px;cursor:default;">
                <div style="display:flex;align-items:center;gap:10px;width:100%;">
                    <div class="pipe-dot"></div>
                    <span style="font-size:1.1rem;">${r.icon}</span>
                    <div class="pipe-name">${r.agent}</div>
                    <div class="pipe-time">${r.duration_s}s</div>
                </div>
                <div style="padding-left:28px;width:100%;overflow:hidden;">${outputHtml}</div>
            </div>`;
                }).join('');

                // Artifacts tab
                const arts = await (await fetch(`/api/claims/${id}/artifacts`)).json();
                $('tabArtifacts').innerHTML = (arts.artifacts || []).length ? (arts.artifacts.map(a => `
            <div style="display:flex;align-items:center;gap:14px;padding:12px 0;border-bottom:1px solid var(--border);">
                <span style="font-size:1.4rem;">${a.type === 'pdf' ? 'ğŸ“„' : a.type === 'blob' ? 'â˜ï¸' : 'ğŸ“‹'}</span>
                <div style="flex:1;">
                    <div style="font-weight:600;font-size:.85rem;">${a.name}</div>
                    <div style="font-size:.75rem;color:var(--text-muted);">${a.description}${a.size_bytes ? ' Â· ' + Math.round(a.size_bytes / 1024) + 'KB' : ''}</div>
                </div>
                ${a.download_url ? `<a href="${a.download_url}" target="_blank" class="btn btn-sm btn-green">Download</a>` : ''}
                ${a.url ? `<span style="font-size:.73rem;color:var(--text-muted);word-break:break-all;">${a.url}</span>` : ''}
            </div>
        `).join('')) : '<div class="empty"><div class="empty__text">No artifacts</div></div>';

                // Audit tab
                const audit = await (await fetch(`/api/audit?claim_id=${id}`)).json();
                if ((audit.entries || []).length) {
                    $('tabAudit').innerHTML = `<table class="tbl"><thead><tr><th>Time</th><th>Action</th><th>Details</th><th>User</th></tr></thead><tbody>${audit.entries.map(e => `<tr><td>${shortTime(e.timestamp)}</td><td><span class="badge-pill info">${e.action}</span></td><td style="max-width:300px;word-break:break-word;">${e.details}</td><td>${e.user}</td></tr>`).join('')
                        }</tbody></table>`;
                } else {
                    $('tabAudit').innerHTML = '<div class="empty"><div class="empty__text">No audit entries for this claim</div></div>';
                }

                // Wire tabs
                document.querySelectorAll('#claimTabs .tab').forEach(t => {
                    t.addEventListener('click', () => {
                        document.querySelectorAll('#claimTabs .tab').forEach(x => x.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active'));
                        t.classList.add('active');
                        document.querySelector(`.tab-content[data-tab="${t.dataset.tab}"]`).classList.add('active');
                    });
                });

            } catch (e) { console.error(e); $('tabRuns').innerHTML = '<div class="empty"><div class="empty__text">Failed to load claim details</div></div>'; }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           KNOWLEDGE BASE
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        let kbFilter = '';
        async function loadKnowledge(filter) {
            if (filter !== undefined) kbFilter = filter;
            try {
                const url = kbFilter ? `/api/knowledge?doc_type=${kbFilter}` : '/api/knowledge';
                const data = await (await fetch(url)).json();
                if (!data.entries.length) {
                    $('kbGrid').innerHTML = '<div class="empty" style="grid-column:1/-1"><div class="empty__icon">ğŸ§ </div><div class="empty__text">No knowledge entries' + (kbFilter ? ' for this type' : ' yet') + '</div><div class="empty__sub">Process a claim to populate the knowledge base</div></div>';
                    return;
                }
                $('kbGrid').innerHTML = data.entries.map(e => {
                    const content = typeof e.data === 'object' ? Object.entries(e.data).map(([k, v]) => `<b>${k}:</b> ${typeof v === 'object' ? JSON.stringify(v) : v}`).join('<br>') : String(e.data);
                    return `<div class="kb-card">
                <div class="kb-card__type">${e.doc_type}</div>
                <div class="kb-card__content">${content}</div>
                <div class="kb-card__footer"><span>${shortTime(e.timestamp)}</span><span>${e.source ? 'Claim: ' + e.source : ''}</span></div>
            </div>`;
                }).join('');
            } catch (e) { console.error(e); }
        }
        document.querySelectorAll('#kbFilters .filter-chip').forEach(c => {
            c.addEventListener('click', () => {
                document.querySelectorAll('#kbFilters .filter-chip').forEach(x => x.classList.remove('active'));
                c.classList.add('active');
                loadKnowledge(c.dataset.filter);
            });
        });

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SETTINGS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        async function loadSettings() {
            try {
                const data = await (await fetch('/api/settings')).json();
                const rows = [
                    ['Azure AI Foundry', 'project_endpoint', data.project_endpoint, data.azure_ai_configured],
                    ['Model Deployment', 'model_deployment_name', data.model_deployment_name, data.azure_ai_configured],
                    ['Blob Storage', 'storage_connection_string', data.storage_connection_string, data.blob_storage_configured],
                    ['Blob Container', 'blob_container_name', data.blob_container_name, data.blob_storage_configured],
                    ['Cognitive Search', 'search_endpoint', data.search_endpoint, data.search_configured],
                    ['Search Index', 'search_index_name', data.search_index_name, data.search_configured],
                ];
                $('settingsBody').innerHTML = rows.map(([label, key, value, ok]) => `
            <div class="setting-row">
                <div class="setting-label">${label}</div>
                <div class="setting-value">${value}</div>
                <div class="setting-badge"><span class="badge-pill ${ok ? 'valid' : 'neutral'}">${ok ? 'Connected' : 'Not Set'}</span></div>
            </div>
        `).join('');
            } catch (e) { console.error(e); }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           NEW CLAIM FORM
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        function setupUpload(inputId, zoneId, fnameId) {
            const inp = $(inputId), zone = $(zoneId), fn = $(fnameId);
            inp.addEventListener('change', () => { if (inp.files.length) { zone.classList.add('has-file'); fn.textContent = 'âœ“ ' + inp.files[0].name; } else { zone.classList.remove('has-file'); fn.textContent = ''; } });
        }
        setupUpload('fPatient', 'uz-patient', 'fnPatient');
        setupUpload('fNotes', 'uz-notes', 'fnNotes');
        setupUpload('fMeta', 'uz-meta', 'fnMeta');

        const STEPS = ['patient_data', 'document_code', 'coverage_validation', 'claim_generation', 'triage'];
        function animatePipeline() {
            $('statusPanel').classList.add('visible'); let i = 0;
            return setInterval(() => { if (i > 0) { const p = document.querySelector(`[data-step="${STEPS[i - 1]}"]`); p.classList.remove('active'); p.classList.add('done'); } if (i < STEPS.length) { document.querySelector(`[data-step="${STEPS[i]}"]`).classList.add('active'); i++; } }, 550);
        }
        function finishPipeline(results) { STEPS.forEach(s => { const el = document.querySelector(`[data-step="${s}"]`); el.classList.remove('active'); const d = results.steps?.[s]; if (d && !d.error) { el.classList.add('done'); if (d.duration_s !== undefined) el.querySelector('.pipe-time').textContent = d.duration_s + 's'; } else { el.classList.add('error'); } }); }
        function resetPipeline() { STEPS.forEach(s => { const el = document.querySelector(`[data-step="${s}"]`); el.className = 'pipe-step'; el.querySelector('.pipe-time').textContent = ''; }); }

        let lastResult = null;
        $('workflowForm').addEventListener('submit', async e => {
            e.preventDefault();
            const pf = $('fPatient').files[0], nf = $('fNotes').files[0], mf = $('fMeta').files[0];
            if (!pf || !nf) { toast('Upload Patient Info and Clinical Notes', 'error'); return; }
            const btn = $('submitBtn'); btn.classList.add('loading'); btn.disabled = true; $('submitText').textContent = 'Processingâ€¦';
            $('resultsPanel').classList.remove('visible'); resetPipeline();
            const iv = animatePipeline();
            const fd = new FormData(); fd.append('patient_file', pf); fd.append('notes_file', nf); if (mf) fd.append('metadata_file', mf);
            try {
                const resp = await fetch('/api/workflow', { method: 'POST', body: fd }); clearInterval(iv);
                if (!resp.ok) throw new Error(await resp.text());
                const r = await resp.json(); lastResult = r; finishPipeline(r);
                const sm = r.summary || {};
                $('rClaimId').textContent = sm.claim_id || 'â€”';
                const dec = $('rDecision'); dec.textContent = sm.decision || 'â€”'; dec.style.color = sm.decision === 'Approve' ? 'var(--green)' : sm.decision === 'Deny' ? 'var(--red)' : 'var(--yellow)';
                $('rAmount').textContent = money(sm.amount); $('rDuration').textContent = (r.total_duration_s || 0) + 's';
                $('rJustification').textContent = sm.justification || 'â€”';
                if (sm.claim_id) {
                    const pb = $('rPdf'); pb.style.display = 'inline-flex'; pb.onclick = () => window.open(`/api/claims/${sm.claim_id}/pdf`, '_blank');
                    const vb = $('rViewDetail'); vb.style.display = 'inline-flex'; vb.onclick = () => navigateTo('claim-detail', sm.claim_id);
                }
                $('resultsPanel').classList.add('visible');
                toast('Claim processed successfully!');
                loadDashboard();
            } catch (err) { clearInterval(iv); toast('Error: ' + err.message, 'error'); }
            finally { btn.classList.remove('loading'); btn.disabled = false; $('submitText').textContent = 'âš¡ Process Claim'; }
        });

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CHAT
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        const chatSessionId = 'session_' + Date.now();
        let chatBusy = false;

        function renderMarkdown(text) {
            return text
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.+?)\*/g, '<em>$1</em>')
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                .replace(/^â€¢ /gm, '&bull; ')
                .replace(/\n/g, '<br>');
        }

        function addChatMessage(content, role, agent) {
            const welcome = document.querySelector('.chat-welcome');
            if (welcome) welcome.remove();
            const msgs = $('chatMessages');
            const div = document.createElement('div');
            div.className = 'chat-msg ' + (role === 'user' ? 'user' : 'bot');
            const avatarEmoji = role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–';
            let bubbleHtml = '';
            if (role !== 'user' && agent) {
                bubbleHtml += '<div class="chat-agent-tag">' + agent + '</div>';
            }
            bubbleHtml += renderMarkdown(content);
            div.innerHTML = '<div class="chat-avatar">' + avatarEmoji + '</div><div class="chat-bubble">' + bubbleHtml + '</div>';
            msgs.appendChild(div);
            msgs.scrollTop = msgs.scrollHeight;
        }

        function addTypingIndicator() {
            const msgs = $('chatMessages');
            const div = document.createElement('div');
            div.className = 'chat-msg bot';
            div.id = 'typingIndicator';
            div.innerHTML = '<div class="chat-avatar">ğŸ¤–</div><div class="chat-bubble"><div class="chat-typing"><span></span><span></span><span></span></div></div>';
            msgs.appendChild(div);
            msgs.scrollTop = msgs.scrollHeight;
        }

        function removeTypingIndicator() {
            const el = $('typingIndicator');
            if (el) el.remove();
        }

        async function sendChatMessage() {
            const input = $('chatInput');
            const message = input.value.trim();
            if (!message || chatBusy) return;

            chatBusy = true;
            $('chatSend').disabled = true;
            input.value = '';

            addChatMessage(message, 'user');
            addTypingIndicator();

            try {
                const resp = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message, session_id: chatSessionId }),
                });
                removeTypingIndicator();
                if (resp.ok) {
                    const data = await resp.json();
                    addChatMessage(data.response, 'bot', data.agent);
                } else {
                    addChatMessage('Sorry, something went wrong. Please try again.', 'bot', 'System');
                }
            } catch (e) {
                removeTypingIndicator();
                addChatMessage('Connection error. Make sure the server is running.', 'bot', 'System');
            } finally {
                chatBusy = false;
                $('chatSend').disabled = false;
                input.focus();
            }
        }

        function sendSuggestion(text) {
            $('chatInput').value = text;
            sendChatMessage();
        }

        $('chatInput').addEventListener('keydown', e => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendChatMessage();
            }
        });

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           INIT
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        loadDashboard();
    </script>
</body>

</html>